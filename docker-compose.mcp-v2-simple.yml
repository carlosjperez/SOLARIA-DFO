version: "3.8"

services:
  mcp-http-v2:
    build:
      context: ./mcp-server
      dockerfile: Dockerfile.http-v2
    container_name: solaria-dfo-mcp-v2
    ports:
      - "3032:3032"
    environment:
      - DASHBOARD_API_URL=http://office:3030/api
      - DASHBOARD_USER=${DASHBOARD_USER:-carlosjperez}
      - DASHBOARD_PASS=${DASHBOARD_PASS:-bypass}
      - JWT_SECRET=${JWT_SECRET:-solaria_jwt_secret_2024_min32chars_secure}
      - MCP_PORT=${MCP_PORT:-3032}
      - NODE_ENV=${NODE_ENV:-production}
      - MCP_VERSION=2.0
    healthcheck:
      test: ["CMD", "curl", "-sf", "http://localhost:3032/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
