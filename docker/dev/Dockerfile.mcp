# SOLARIA MCP HTTP Server - Development Dockerfile
# With TypeScript hot-reload using tsx watch

FROM node:22-alpine

WORKDIR /app

# Install all dependencies (including devDependencies for tsx)
COPY mcp-server/package*.json ./
RUN npm install

# NOTE: Source code mounted as volume for hot-reload
# No COPY of source code here

# Development environment
ENV NODE_ENV=development
ENV MCP_PORT=3031

# Expose port
EXPOSE 3031

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
  CMD wget --no-verbose --tries=1 --spider http://127.0.0.1:3031/health || exit 1

# Start with tsx watch for hot-reload
CMD ["npx", "tsx", "watch", "src/http-server.ts"]
